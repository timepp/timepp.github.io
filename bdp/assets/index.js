var H=Object.defineProperty;var q=(c,e,t)=>e in c?H(c,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[e]=t;var h=(c,e,t)=>(q(c,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();var m=(c=>(c[c.UnsignedNumber=0]="UnsignedNumber",c[c.SignedNumber=1]="SignedNumber",c[c.Offset=2]="Offset",c[c.Size=3]="Size",c[c.String=4]="String",c[c.NullTerminatedString=5]="NullTerminatedString",c[c.GeneralData=6]="GeneralData",c[c.Compound=7]="Compound",c))(m||{}),b=(c=>(c[c.BE=0]="BE",c[c.LE=1]="LE",c))(b||{});function C(c,e,t){const r=new Uint8Array(t),s=new Uint8Array(c,e,t.length);for(let n=0;n<t.length;n++)if(r[n]!==s[n])return!1;return!0}function G(c,e,t){if(!C(c,e,t))throw Error("fixed content mismatch")}function L(c,e,t=!0){const r=new Uint8Array(c);if(t)for(let s=0;s<=r.length-e.length;s++){let n=!0;for(let o=0;o<e.length;o++)r[s+o]!==e[o]&&(n=!1);if(n)return s}else for(let s=c.byteLength-e.length;s>=0;s--){let n=!0;for(let o=0;o<e.length;o++)r[s+o]!==e[o]&&(n=!1);if(n)return s}return-1}function D(c,e,t,r,s){const n=r?e:t-1,o=r?t:e-1,i=r?1:-1,a=new Uint8Array(c);let l=0n,d=1n;for(let u=n;u!==o;u+=i)l=l*256n,l+=BigInt(a[u]),d*=256n;return s&&a[n]>=128&&(l=l-d),l}function _(c,e){let t=0,r=e.length;for(;t<r;){const s=Math.floor((t+r)/2),n=e[s];if(n===void 0)return;n.startPos>=c?r=s:n.startPos<c&&(t=s+1)}r===e.length&&r--;for(let s=r;s>=0;s--){const n=e[s];if(n===void 0)return;if(c>=n.startPos&&c<n.endPos)return n.type===m.Compound&&_(c,n.subRegions)||n}}function U(c,e){const t=[];let r=c.parent;for(;c&&c!==e;){const s=r.subRegions.indexOf(c);t.push(s),c=r,r=r.parent}return t.reverse()}class F{constructor(e){h(this,"endian",b.LE);h(this,"textEncoding","utf-8");h(this,"buffer");h(this,"position");h(this,"num");h(this,"regionCache");this.buffer=e,this.position=0,this.num={},this.regionCache={},this.endian=b.LE}fork(e,t){e===-1&&(e=this.position),e<0&&(e=this.buffer.byteLength+e);const r=new F(this.buffer.slice(0,e+t));return r.position=e,r.endian=this.endian,r}regulatePosAndLength(e,t){return e===-1&&(e=this.position),t===-1&&(t=this.buffer.byteLength-e),[e,t]}finishingCreateScalarRegion(e,t){t&&t(e),this.position=e.endPos,this.regionCache[e.ID]=e}createCompoundRegion(e,t,r="",s="",n=-1,o=-1){let i;if(Array.isArray(t))i=t;else{i=Object.keys(t).map(l=>t[l]);for(const l in t)t[l].ID===""&&(t[l].ID=l)}i.length>0?(n===-1&&(n=i[0].startPos),o===-1&&(o=i[i.length-1].endPos-n)):[n,o]=this.regulatePosAndLength(n,o);const a={ID:e,type:m.Compound,description:s,interpretedValue:r,startPos:n,endPos:n+o,subRegions:i};return i.forEach(l=>l.parent=a),a}parseData(e,t,r,s="",n){[e,t]=this.regulatePosAndLength(e,t);const o={ID:r,type:m.GeneralData,description:s,startPos:e,endPos:e+t};return this.finishingCreateScalarRegion(o,n),o}parseNumber(e,t,r,s,n){return this.parseNumberInternal(m.UnsignedNumber,e,t,r,s,n)}parseSignedNumber(e,t,r,s,n){return this.parseNumberInternal(m.SignedNumber,e,t,r,s,n)}parseOffset(e,t,r,s,n){return this.parseNumberInternal(m.Offset,e,t,r,s,n)}parseSize(e,t,r,s,n){return this.parseNumberInternal(m.Size,e,t,r,s,n)}parseString(e,t,r,s,n){[e,t]=this.regulatePosAndLength(e,t);const i=new TextDecoder().decode(this.buffer.slice(e,e+t)),a={ID:r,type:m.String,value:i,description:s||"",startPos:e,endPos:e+t};return this.finishingCreateScalarRegion(a,n),a}parseNullTerminatedString(e,t,r,s,n){[e,t]=this.regulatePosAndLength(e,t);const o=L(this.buffer.slice(e,e+t),[0]),i=o===-1?t:o,a=o===-1?t:o+1,d=new TextDecoder(this.textEncoding).decode(this.buffer.slice(e,e+i)),u={ID:r,type:m.NullTerminatedString,value:d,description:s||"",startPos:e,endPos:e+a};return this.finishingCreateScalarRegion(u,n),u}searchPattern(e,t=!0,r=0){const s=L(this.buffer.slice(this.position+r),e,t);return s===-1?-1:s+r}checkPattern(e){return C(this.buffer,this.position,e)}parseNumberInternal(e,t,r,s,n,o){[t,r]=this.regulatePosAndLength(t,r);let i=0n;switch(e){case m.UnsignedNumber:case m.Offset:case m.Size:i=D(this.buffer,t,t+r,this.endian===b.BE,!1),this.num[s]=Number(i);break;case m.SignedNumber:i=D(this.buffer,t,t+r,this.endian===b.BE,!0),this.num[s]=Number(i);break;default:throw new Error(`Region Type ${e} is not number type`)}const a={ID:s,type:e,bigValue:i,value:Number(i),description:n||"",startPos:t,endPos:t+r,endian:this.endian};return this.finishingCreateScalarRegion(a,o),a}parseNextData(e,t="",r="",s){return this.parseData(-1,e,t,r,s)}parseNextNullTerminatedString(e,t="",r,s){return this.parseNullTerminatedString(-1,e,t,r,s)}parseNextString(e,t="",r,s){return this.parseString(-1,e,t,r,s)}parseNextSize(e,t="",r,s){return this.parseSize(-1,e,t,r,s)}parseNextOffset(e,t="",r,s){return this.parseOffset(-1,e,t,r,s)}parseNextSignedNumber(e,t="",r,s){return this.parseSignedNumber(-1,e,t,r,s)}parseNextNumber(e,t="",r,s){return this.parseNumber(-1,e,t,r,s)}createTempRegion(){return{ID:"",type:m.GeneralData,description:"",startPos:0,endPos:0}}convertToCompoundRegion(e,t){const r=e;r.type=m.Compound,r.subRegions=t;for(const s of t)s.parent=r;return r}replaceSubRegion(e,t,r){e.subRegions.splice(t,1,...r);for(const s of r)s.parent=e}contentValidator(e){const t=this;return function(r){G(t.buffer,r.startPos,e)}}setEndian(e){this.endian=e}getNumber(e,t){if(e!==void 0){for(const r of e)if(r.ID===t)return Number(r.value)}return 0}setPosition(e){this.position=e}advance(e){this.position+=e}EOF(){return this.position>=this.buffer.byteLength}}const P=[137,80,78,71,13,10,26,10],j={0:"Grayscale",2:"RGB",3:"Palette",4:"Grayscale+alpha",6:"RGBA"};class z{supports(e,t,r){return t==="png"||C(r,0,P)}checkFileHeader(e){return C(e,0,P)}parse(e){e.endian=b.BE;const t=[];for(t.push(e.parseNextData(P.length,"signature","",e.contentValidator(P)));e.position<e.buffer.byteLength;){const r=e.parseNextSize(4,"Length"),s=e.parseNextString(4,"Type"),n=this.parseTrunkData(e.fork(-1,r.value),s.value),o=e.parseNumber(s.endPos+Number(r.value),4,"CRC"),i=e.createCompoundRegion("trunk",[r,s,n,o],s.value);t.push(i)}return e.createCompoundRegion("PNG",t)}parseTrunkData(e,t){if(t==="IHDR"){const r={width:e.parseNumber(-1,4,"Width"),height:e.parseNumber(-1,4,"Height"),bits:e.parseNumber(-1,1,"Bit depth"),colorType:e.parseNumber(-1,1,"Color type"),compressMethod:e.parseNumber(-1,1,"Compress method"),filterMethod:e.parseNumber(-1,1,"Filter method"),interlaceMethod:e.parseNumber(-1,1,"Interlace method")},s=`${r.width.value}x${r.height.value}, ${r.bits.value} bit, ${j[r.colorType.value]||"unknown"}${r.interlaceMethod.value?", interlaced":""}`;return e.createCompoundRegion("Data - Header",r,s)}else if(t==="tEXt"){const r=e.parseNextNullTerminatedString(-1,"key"),s=e.parseNextString(-1,"value");return e.createCompoundRegion("Data",[r,s],`${r.value}:${s.value}`)}else return e.parseNextData(-1,"Data")}}class V{constructor(){h(this,"supports",["bmp"]);h(this,"description","https://en.wikipedia.org/wiki/BMP_file_format")}parse(e){e.setEndian(b.LE);const t=e.createCompoundRegion("BitmapFileHeader",[e.parseNextString(2,"Header","",e.contentValidator([66,77])),e.parseNextSize(4,"FileSize"),e.parseNextData(4,"Reserved"),e.parseNextOffset(4,"ImageDataOffset")]);return e.createCompoundRegion("BMP",[t,...this.parseContent(e)])}parseContent(e){e.setEndian(b.LE);const t=[],r={HeaderSize:e.parseNextSize(4),Width:e.parseNextNumber(4),Height:e.parseNextSignedNumber(4),Planes:e.parseNextNumber(2),BitsPerPixel:e.parseNextNumber(2),CompressionMethod:e.parseNextNumber(4),RawDataSize:e.parseNextNumber(4),HorizontalPixelPerMeter:e.parseNextSignedNumber(4),VerticalPixelPerMeter:e.parseNextSignedNumber(4),ColorsInPalette:e.parseNextNumber(4),ImportantColorCount:e.parseNextNumber(4)},s=Math.abs(r.Height.value),n=r.Height.value<0?" top down":"",o=e.createCompoundRegion("DIB Header",r,`${r.Width.value}x${s}${n} ${r.BitsPerPixel.value} bits per pixel`);t.push(o);const i={3:12,6:16}[r.CompressionMethod.value]||0;i>0&&t.push(e.parseNextData(i,"BitFieldsMask"));let a=r.ColorsInPalette.value;if(a===0&&r.BitsPerPixel.value<=8&&(a=1<<r.BitsPerPixel.value),a){const l=[];for(let d=0;d<a;d++){const u={B:e.parseNextNumber(1),G:e.parseNextNumber(1),R:e.parseNextNumber(1),Reserved:e.parseNextNumber(1)};l.push(e.createCompoundRegion("ColorPaletteEntry",u,`color: RGB(${u.R.value},${u.G.value},${u.B.value})`))}t.push(e.createCompoundRegion("ColorTable",l))}if(r.CompressionMethod.value===0){const l=r.BitsPerPixel.value/8*Number(r.Width.value),d=Math.ceil(l/4)*4,u=[...new Array(s)].map((p,f)=>e.parseNextData(d,"PixelRow#"+(f+1)));t.push(e.createCompoundRegion("PixelArray",u))}else t.push(e.parseNextData(r.RawDataSize.value,"PixelStorage"));return t}}class W{constructor(){h(this,"supports",["ico"])}parse(e){const t=e.parseNextData(4,"signature","ICO file signature (00 00 01 00)",e.contentValidator([0,0,1,0])),r=e.parseNextSize(2,"imageSize","number of images the ico contains"),s=[],n=[],o=e.position,i=a=>(a.value===0&&(a.interpretedValue="256"),a);for(let a=0;a<r.value;a++){const l={width:i(e.parseNumber(o+a*16,1,"width","image width in pixels (0 means 256),")),height:i(e.parseNextNumber(1,"height","image height in pixels (0 means 256),")),paletteNumber:e.parseNextNumber(1,"paletteNumber","number of colors in the color palette"),reserved:e.parseNextNumber(1,"reserved","should be 0"),planes:e.parseNextNumber(2,"planes","color planes"),bits:e.parseNextNumber(2,"bits","bits per pixel"),size:e.parseNextSize(4,"size","image size in bytes"),offset:e.parseNextOffset(4,"offset","offset of the image data")},d=e.createCompoundRegion("Icon Descriptor",l,`${l.width.value}x${l.height.value} ${l.bits.value} bits`);n.push(d);try{const u=new z().parse(e.fork(l.offset.value,l.size.value));s.push(e.createCompoundRegion("image data (PNG)",[u]))}catch{const p=new V().parseContent(e.fork(l.offset.value,l.size.value));s.push(e.createCompoundRegion("image data (BMP)",p))}}return e.createCompoundRegion("ICO",[t,r,e.createCompoundRegion("iconDirectories",n),e.createCompoundRegion("Images",s)])}}class Z{constructor(){h(this,"description","RIFF container");h(this,"supports",[])}parse(e){e.setEndian(b.LE);const t=e.parseNextNullTerminatedString(4,"FourCC");if(t.value!=="RIFF")throw new Error("Not a RIFF file");const r=e.parseNextSize(4,"Size","RIFF chunk size"),s=e.parseNextString(4,"FormType"),n=this.parseChunks(e);return e.createCompoundRegion("RIFF",[t,r,s,...n],s.value)}parseChunks(e){const t=[];for(;!e.EOF();){const r=e.parseNextNullTerminatedString(4,"FourCC"),s=e.parseNextSize(4,"Size","RIFF chunk size"),n=this.parseContent(e.fork(-1,s.value),r.value),o=e.createCompoundRegion(r.value,[r,s,...n],r.value,"",r.startPos,s.value+8);t.push(o),e.setPosition(o.endPos)}return t}parseContent(e,t){return t==="LIST"?[e.parseNextString(4,"ListName"),...this.parseChunks(e)]:[e.parseNextData(-1,"data")]}}class K{constructor(){h(this,"description","RIFF (wav, ani)");h(this,"supports",["wav","ani"])}parse(e){e.setEndian(b.LE);const t=new Z().parse(e);if(t.interpretedValue!=="WAVE")throw new Error("Not a WAVE file");for(const s of t.subRegions)if(s.ID==="fmt "){const n=s,o=n.subRegions[2];e.setPosition(o.startPos);const i=[e.parseNextNumber(2,"formatTag"),e.parseNextSize(2,"channels"),e.parseNextNumber(4,"samplesPerSecond"),e.parseNextNumber(4,"avgBytesPerSecond"),e.parseNextNumber(2,"blockAlign"),e.parseNextNumber(2,"bitsPerSample")];if(o.endPos-e.position>=2){const a=e.parseNextSize(2,"extLen");if(i.push(a),a.value>0){const l=[e.parseNextNumber(2,"validBitsPerSample"),e.parseNextNumber(4,"channelMask"),e.parseNextData(16,"subFormat")];i.push(...l)}}e.replaceSubRegion(n,2,i)}return t}}const E=[0,0,1],X=[0,0,0,1],B=["Unspecified","Non-IDR picture","data partition A","data partition B","data partition C","IDR picture","SEI (Supplemental enhancement information)","SPS (Sequence parameter set)","PPS (Picture parameter set)","Access unit delimiter","End of sequence","End of stream","Filler data","Sequence parameter set extension","Prefix NAL unit","Subset sequence parameter set","Reserved","Reserved","Reserved","auxiliary coded picture without partitioning","Coded slice extension","Coded slice extension for depth view components","Reserved","Reserved","Unspecified"];class Y{supports(e,t,r){return t==="h264"||C(r,0,E)||C(r,0,X)}parse(e){e.endian=b.BE;const t=[];for(;e.position<e.buffer.byteLength;)t.push(this.parseNAL(e));return e.createCompoundRegion("H264 Stream",t)}parseNAL(e){const t=e.parseNextData(3,"NAL Start Code","",e.contentValidator(E)),r=e.parseNextNumber(1,"NAL Unit Header"),s=r.value&31,n=s<B.length?B[s]:"Unspecified",o=r.value>>5&3;r.interpretedValue=`Reference: ${o}, Type: ${s} - ${n}`;const i=e.searchPattern(E),a=this.parseNALContent(e,s,o,i);return e.createCompoundRegion("NAL",[t,r,...a],n)}parseNALContent(e,t,r,s){return[e.parseNextData(s,"NAL Content")]}}class J{constructor(){h(this,"supports",["mp4"])}parse(e){e.setEndian(b.BE);const t=this.parseBoxes(e,{ftyp:this.parseFileTypeBox,moov:this.parseMOOV});return e.createCompoundRegion("Boxes",t)}parseBoxes(e,t){var s;const r=[];for(;!e.EOF();){const n=e.parseNextSize(4,"Size"),o=e.parseNextNullTerminatedString(4,"Type"),i=e.fork(-1,n.value-8);e.advance(n.value-8);const a=((s=t[o.value])==null?void 0:s.call(this,i))||[],l=e.createCompoundRegion("Box",[n,o,...a],o.value);l.endPos=n.value+l.startPos,r.push(l)}return r}parseFileTypeBox(e){const t=e.parseNextNullTerminatedString(4,"MajorBrand"),r=e.parseNextNumber(4,"MinorVersion"),s=[];for(;!e.EOF();)s.push(e.parseNextNullTerminatedString(4,"Brand"));const n=e.createCompoundRegion("CompatibleBrands",s);return[t,r,n]}parseMOOV(e){return this.parseBoxes(e,{mvhd:this.parseMVHD,trak:this.parseTRAK})}parseMVHD(e){const t=e.parseNextNumber(1,"Version"),r=e.parseNextNumber(3,"Flags"),s=e.parseNextNumber(4,"CreationTime"),n=e.parseNextNumber(4,"ModificationTime"),o=e.parseNextNumber(4,"Timescale"),i=e.parseNextNumber(4,"Duration"),a=e.parseNextNumber(4,"Rate"),l=e.parseNextNumber(2,"Volume"),d=e.parseNextNumber(2,"Reserved"),u=e.parseNextData(36,"Matrix"),p=e.parseNextData(24,"PreDefined"),f=e.parseNextNumber(4,"NextTrackID");return[t,r,s,n,o,i,a,l,d,u,p,f]}parseTRAK(e){return this.parseBoxes(e,{tkhd:this.parseTKHD,mdia:this.parseMDIA})}parseTKHD(e){const t=e.parseNextNumber(1,"Version"),r=e.parseNextNumber(3,"Flags"),s=e.parseNextNumber(4,"CreationTime"),n=e.parseNextNumber(4,"ModificationTime"),o=e.parseNextNumber(4,"TrackID"),i=e.parseNextNumber(4,"Reserved"),a=e.parseNextNumber(4,"Duration"),l=e.parseNextData(8,"Reserved2"),d=e.parseNextNumber(2,"Layer"),u=e.parseNextNumber(2,"AlternateGroup"),p=e.parseNextNumber(2,"Volume"),f=e.parseNextNumber(2,"Reserved3"),x=e.parseNextData(36,"Matrix"),N=e.parseNextNumber(4,"Width"),v=e.parseNextNumber(4,"Height");return[t,r,s,n,o,i,a,l,d,u,p,f,x,N,v]}parseMDIA(e){return this.parseBoxes(e,{mdhd:this.parseMDHD,hdlr:this.parseHDLR,minf:this.parseMINF})}parseMDHD(e){const t=e.parseNextNumber(1,"Version"),r=e.parseNextNumber(3,"Flags"),s=e.parseNextNumber(4,"CreationTime"),n=e.parseNextNumber(4,"ModificationTime"),o=e.parseNextNumber(4,"Timescale"),i=e.parseNextNumber(4,"Duration"),a=e.parseNextNumber(2,"Language"),l=e.parseNextNumber(2,"PreDefined");return[t,r,s,n,o,i,a,l]}parseHDLR(e){const t=e.parseNextNumber(1,"Version"),r=e.parseNextNumber(3,"Flags"),s=e.parseNextNumber(4,"PreDefined"),n=e.parseNextNullTerminatedString(4,"HandlerType"),o=e.parseNextData(12,"Reserved"),i=e.parseNextNullTerminatedString(-1,"Name");return[t,r,s,n,o,i]}parseMINF(e){return this.parseBoxes(e,{vmhd:this.parseVMHD,smhd:this.parseSMHD,dinf:this.parseDINF,stbl:this.parseSTBL})}parseVMHD(e){const t=e.parseNextNumber(1,"Version"),r=e.parseNextNumber(3,"Flags"),s=e.parseNextNumber(2,"GraphicsMode"),n=e.parseNextData(6,"Opcolor");return[t,r,s,n]}parseSMHD(e){const t=e.parseNextNumber(1,"Version"),r=e.parseNextNumber(3,"Flags"),s=e.parseNextNumber(2,"Balance"),n=e.parseNextNumber(2,"Reserved");return[t,r,s,n]}parseDINF(e){return this.parseBoxes(e,{dref:this.parseDREF})}parseDREF(e){const t=e.parseNextNumber(1,"Version"),r=e.parseNextNumber(3,"Flags"),s=e.parseNextNumber(4,"EntryCount"),n=[];for(let o=0;o<s.value;o++)n.push(this.parseDREFEntry(e));return[t,r,s,...n]}parseDREFEntry(e){const t=e.parseNextNumber(4,"Size"),r=e.parseNextNullTerminatedString(4,"Type"),s=e.parseNextNumber(1,"Version"),n=e.parseNextNumber(3,"Flags"),o=e.parseNextData(-1,"Data");return e.createCompoundRegion("DREFEntry",[t,r,s,n,o])}parseSTBL(e){return this.parseBoxes(e,{stsd:this.parseSTSD,stts:this.parseSTTS,stsc:this.parseSTSC,stsz:this.parseSTSZ,stco:this.parseSTCO,co64:this.parseCO64})}parseSTSD(e){const t=e.parseNextNumber(1,"Version"),r=e.parseNextNumber(3,"Flags"),s=e.parseNextNumber(4,"EntryCount"),n=[];for(let o=0;o<s.value;o++)n.push(this.parseSTSDEntry(e));return[t,r,s,...n]}parseSTSDEntry(e){const t=e.parseNextNumber(4,"Size"),r=e.parseNextNullTerminatedString(4,"Format"),s=e.parseNextData(6,"Reserved"),n=e.parseNextNumber(2,"DataReferenceIndex"),o=e.parseNextData(-1,"Data");return e.createCompoundRegion("stsdEntry",[t,r,s,n,o])}parseSTTS(e){const t=e.parseNextNumber(1,"Version"),r=e.parseNextNumber(3,"Flags"),s=e.parseNextNumber(4,"EntryCount"),n=[];for(let o=0;o<s.value;o++)n.push(this.parseSTTSEntry(e));return[t,r,s,...n]}parseSTTSEntry(e){const t=e.parseNextNumber(4,"SampleCount"),r=e.parseNextNumber(4,"SampleDelta");return e.createCompoundRegion("sttsEntry",[t,r])}parseSTSC(e){const t=e.parseNextNumber(1,"Version"),r=e.parseNextNumber(3,"Flags"),s=e.parseNextNumber(4,"EntryCount"),n=[];for(let o=0;o<s.value;o++)n.push(this.parseSTSCEntry(e));return[t,r,s,...n]}parseSTSCEntry(e){const t=e.parseNextNumber(4,"FirstChunk"),r=e.parseNextNumber(4,"SamplesPerChunk"),s=e.parseNextNumber(4,"SampleDescriptionIndex");return e.createCompoundRegion("stscEntry",[t,r,s])}parseSTSZ(e){const t=e.parseNextNumber(1,"Version"),r=e.parseNextNumber(3,"Flags");let s=e.parseNextNumber(4,"SampleSize");const n=e.parseNextNumber(4,"SampleCount"),o=[];if(s.value===0)for(let i=0;i<n.value;i++)o.push(e.parseNextNumber(4,"Entry"));return[t,r,s,n,...o]}parseSTCO(e){const t=e.parseNextNumber(1,"Version"),r=e.parseNextNumber(3,"Flags"),s=e.parseNextNumber(4,"EntryCount"),n=[];for(let o=0;o<s.value;o++)n.push(e.parseNextNumber(4,"Entry"));return[t,r,s,...n]}parseCO64(e){return this.parseSTCO(e)}}class Q{supports(e,t,r){return t==="zip"||C(r,0,[80,75,3,4])}parse(e){const t=e.searchPattern([80,75,5,6],!1);if(t===-1)throw"cannot find EOCD";const r={signature:e.parseData(t,4,""),diskNum:e.parseNextNumber(2),centralDirectoryStartDiskNum:e.parseNextNumber(2),centralDirectoryRecordsInCurrentDisk:e.parseNextNumber(2),centralDirectoryRecords:e.parseNextNumber(2),centralDirectorySize:e.parseNextNumber(4),centralDirectoryOffset:e.parseNextNumber(4),commentLength:e.parseNextNumber(2),comment:e.createTempRegion()};r.comment=e.parseNextString(r.commentLength.value);const s=e.createCompoundRegion("EOCD",r),n=e.createCompoundRegion("CentralDirectory",new Array(r.centralDirectoryRecords.value),"","",r.centralDirectoryOffset.value,r.centralDirectorySize.value);n.subRegionFetcher=i=>{if(n.subRegions[i]===void 0){let a=-1,l=n.startPos;for(let d=i-1;d>=0;d--)n.subRegions[d]!==void 0&&(a=d,l=n.subRegions[d].endPos);for(let d=a;d<i-1;d++){const u=D(e.buffer,l+28,l+30,!1,!1),p=D(e.buffer,l+30,l+32,!1,!1),f=D(e.buffer,l+32,l+34,!1,!1);l+=46+Number(u)+Number(p)+Number(f)}n.subRegions[i]=this.parseCD(e,l)}return n.subRegions[i]};const o=e.createCompoundRegion("LocalFiles",new Array(r.centralDirectoryRecords.value),"","",0,r.centralDirectoryOffset.value);return o.subRegionFetcher=i=>{if(o.subRegions[i]===void 0){let a=n.subRegions[i]||n.subRegionFetcher(i);const l=e.getNumber(a.subRegions,"localHeaderOffset");o.subRegions[i]=this.parseLocalFile(e,l)}return o.subRegions[i]},e.createCompoundRegion("ZIP",[o,n,s])}parseCD(e,t){e.setPosition(t);const r={signature:e.parseNextData(4,"","",e.contentValidator([80,75,1,2])),version:e.parseNextNumber(2),versionMin:e.parseNextNumber(2),generalPurpose:e.parseNextNumber(2),compressionMethod:e.parseNextNumber(2),mtime:e.parseNextNumber(2),mdate:e.parseNextNumber(2),crc32:e.parseNextNumber(4),compressedSize:e.parseNextNumber(4),uncompressedSize:e.parseNextNumber(4),filenameLength:e.parseNextNumber(2),extraFieldLength:e.parseNextNumber(2),commentLength:e.parseNextNumber(2),diskNum:e.parseNextNumber(2),internalFileAttributes:e.parseNextNumber(2),externalFileAttributes:e.parseNextNumber(4),localHeaderOffset:e.parseNextNumber(4)},s={...r,filename:e.parseNextString(r.filenameLength.value),extraField:e.parseNextData(r.extraFieldLength.value),comment:e.parseNextString(r.commentLength.value)};return e.createCompoundRegion("CDRecord",s,s.filename.value)}parseLocalFile(e,t){e.setPosition(t);const r={signature:e.parseNextData(4,"","",e.contentValidator([80,75,3,4])),version:e.parseNextNumber(2),generalPurpose:e.parseNextNumber(2),compressionMethod:e.parseNextNumber(2),mtime:e.parseNextNumber(2),mdate:e.parseNextNumber(2),crc32:e.parseNextNumber(4),compressedSize:e.parseNextNumber(4),uncompressedSize:e.parseNextNumber(4),filenameLength:e.parseNextNumber(2),extraFieldLength:e.parseNextNumber(2)},s={...r,filename:e.parseNextString(r.filenameLength.value),extraField:e.parseNextData(r.extraFieldLength.value),compressedData:e.parseNextData(r.compressedSize.value)};return e.createCompoundRegion("LocalFile",r,s.filename.value)}}const M=["EOC","Boolean","Integer","BitString","OctetString","NULL","OID","ObjectDescriptor","External","Real","Enumerated","EmbededPDV","UTF8String","RelativeOID","Time","Reserved","Sequence","Set","NumericString","PrintableString","T61String","VideotexString","IA5String","UTCTime","GeneralizedTime","GraphicString","VisibleString","GeneralString","UniversalString","CharacterString","BMPString","Date","TimeOfDay","DateTime","Duration","OIDIRI","RelativeOIDIRI"];class ee{supports(e,t,r){return t==="ber"||t==="der"||t==="cer"}parse(e){return e.createCompoundRegion("TLV container",this.parseTLVs(e))}parseTLV(e){const t=new Uint8Array(e.buffer.slice(e.position)),[r,s]=te(t),[n,o,i]=re(t.slice(s)),a={ID:"Type",type:m.GeneralData,description:`${r.tagNumber}`,startPos:e.position,endPos:e.position+s,interpretedValue:r.tagClass===0?M[r.tagNumber]:`${r.tagNumber}`},l={ID:"Length",type:m.UnsignedNumber,description:"",startPos:e.position+s,endPos:e.position+s+o,endian:b.BE,value:n,bigValue:BigInt(n)},d=this.parseValue(e,r,e.position+s+o,n),u=[a,l,d];i&&u.push({ID:"EOC",type:m.GeneralData,description:"",startPos:e.position+s+o+n,endPos:e.position+s+o+n+2});const p=e.createCompoundRegion("TLV",u);return e.position=p.endPos,p}parseTLVs(e){const t=[];for(;!e.EOF();)t.push(this.parseTLV(e));return t}parseValue(e,t,r,s){if(t.constructed){const n=e.fork(r,s);return e.createCompoundRegion("Value",this.parseTLVs(n))}else return{ID:"Value",type:m.GeneralData,description:"",startPos:r,endPos:r+s}}}function te(c){const e=c[0]>>6,t=(c[0]>>5&1)===1,r=c[0]&31;let s=1,n=r;if(r===31){n=0;let i=1;for(;;i++){const a=c[i]&127;if(n=n*128+a,c[i]<128)break}s=i+1}const o=e===0?M[r]:"";return[{tagClass:e,constructed:t,tagNumber:n,name:o},s]}function re(c){if(c[0]<128)return[c[0],1,!1];if(c[0]===128){for(let r=0;;r++)if(c[r]===0&&c[r+1]===0)return[r-1,1,!0];throw"EOC not found in ASN indefinite form"}const e=c[0]&127,t=D(c,1,e+1,!0,!1);return[Number(t),e+1,!1]}class se{constructor(){h(this,"supports",["ttf"])}parse(e){e.setEndian(b.BE);const t={scalarType:e.parseNextNumber(4,"","A tag to indicate the OFA scaler to be used to rasterize this font"),numTables:e.parseNextNumber(2,"","Number of tables in the font"),searchRange:e.parseNextNumber(2,"","Maximum power of 2 <= numTables * 16"),entrySelector:e.parseNextNumber(2,"","Log2(maximum power of 2 <= numTables * 16)"),rangeShift:e.parseNextNumber(2,"","NumTables * 16 - searchRange")},r=e.createCompoundRegion("OffsetSubTable",t,""," keeps record of the tables in the font and provides offset information to access each table in the directory"),s=[],n=[];for(let a=0;a<t.numTables.value;a++){const{t:l,td:d}=this.parseTableDirectory(e);s.push(d);const u=this.parseTable(e.fork(l.offset.value,l.length.value),l.tag.value);n.push(u)}const o=e.createCompoundRegion("TableDirectory",s,"","Contains entries for each table in the font"),i=e.createCompoundRegion("Tables",n.sort((a,l)=>a.startPos-l.startPos),"","Contains the actual data for each table in the font");return[r,o,i]}parseTableDirectory(e){const t={tag:e.parseNextString(4,"","A four-byte identifier"),checksum:e.parseNextNumber(4,"","Checksum for this table"),offset:e.parseNextOffset(4,"","Offset from beginning of TrueType font file"),length:e.parseNextSize(4,"","Length of this table in bytes")},r=e.createCompoundRegion("TableInfo",t,"","Contains information about a table in the font");return r.interpretedValue=`${t.tag.value} @ 0x${t.offset.value.toString(16)}`,{t,td:r}}parseTable(e,t){return t==="head"?e.createCompoundRegion("head Table",[e.parseNextNumber(4,"version","Version number of the font header table"),e.parseNextNumber(4,"fontRevision","Set by font manufacturer"),e.parseNextNumber(4,"checksumAdjustment","To compute: set it to 0, sum the entire font as uint32, then store 0xB1B0AFBA - sum"),e.parseNextNumber(4,"magicNumber","Set to 0x5F0F3CF5"),e.parseNextNumber(2,"flags","Bit 0: y value of 0 specifies baseline, Bit 1: x position of left most black bit is LSB, Bit 2: scaled point size and actual point size will differ, Bit 3: use integer scaling for all internal scaler math, Bit 4: instructions may alter advance width (the advance widths might not scale linearly), Bit 5: this bit should be set as it controls the interpretation of the units per em"),e.parseNextNumber(2,"unitsPerEm","Valid range is from 64 to 16384"),e.parseNextData(8,"created","International date (8-byte field)"),e.parseNextData(8,"modified","International date (8-byte field)"),e.parseNextNumber(2,"xMin","For all glyph bounding boxes"),e.parseNextNumber(2,"yMin","For all glyph bounding boxes"),e.parseNextNumber(2,"xMax","For all glyph bounding boxes"),e.parseNextNumber(2,"yMax","For all glyph bounding boxes"),e.parseNextNumber(2,"macStyle","Bit 0: Bold, Bit 1: Italic, Bit 2: Underline, Bit 3: Outline, Bit 4: Shadow, Bit 5: Condensed (Narrow), Bit 6: Extended, Bits 7-15: Reserved"),e.parseNextNumber(2,"lowestRecPPEM","Smallest readable size in pixels"),e.parseNextNumber(2,"fontDirectionHint","0: Fully mixed directional glyphs, 1: Only strongly left to right, 2: Like 1 but also contains neutrals, -1: Only strongly right to left, -2: Like -1 but also contains neutrals"),e.parseNextNumber(2,"indexToLocFormat","0 for short offsets, 1 for long"),e.parseNextNumber(2,"glyphDataFormat","0 for current format")]):t==="maxp"?e.createCompoundRegion("maxp Table",[e.parseNextNumber(4,"version","Version number of the table"),e.parseNextNumber(2,"numGlyphs","The number of glyphs in the font"),e.parseNextNumber(2,"maxPoints","Points in non-compound glyph"),e.parseNextNumber(2,"maxContours","Contours in non-compound glyph"),e.parseNextNumber(2,"maxCompositePoints","Points in compound glyph"),e.parseNextNumber(2,"maxCompositeContours","Contours in compound glyph"),e.parseNextNumber(2,"maxZones","Set to 2"),e.parseNextNumber(2,"maxTwilightPoints","Points used in Twilight Zone (Z0), at 0x70 to 0x7F"),e.parseNextNumber(2,"maxStorage","Number of Storage Area locations"),e.parseNextNumber(2,"maxFunctionDefs","Number of FDEFs"),e.parseNextNumber(2,"maxInstructionDefs","Number of IDEFs"),e.parseNextNumber(2,"maxStackElements","Maximum stack depth"),e.parseNextNumber(2,"maxSizeOfInstructions","In FUnits"),e.parseNextNumber(2,"maxComponentElements","Number of glyphs referenced at top level"),e.parseNextNumber(2,"maxComponentDepth","Levels of recursion, set to 0 if font has only simple glyphs")]):e.parseNextData(-1,`${t} Table`)}}class ne{constructor(){h(this,"supports",["mp3"])}parse(e){e.setEndian(b.BE);const t=[];if(e.checkPattern([73,68,51])){const a=this.parseID3v2(e);t.push(a)}const r=e.createCompoundRegion("MP3Frames",[]);t.push(r);const s=this.parseID3v1(e.fork(-128,128));s&&(t.push(s),e=e.fork(0,e.buffer.byteLength-128)),e.setPosition(r.startPos);const n=[];let o=1,i=e.searchPattern([255,251]);if(i!==-1)for(e.advance(i);!e.EOF();){let a=e.searchPattern([255,251],!0,8);n.push(e.parseNextData(a,"Mp3Frame #"+o++))}return r.subRegions.push(...n),t}parseID3v1(e){return e.searchPattern([84,65,71])===0?e.parseNextData(128,"ID3v1"):null}parseID3v2(e){const t={fileID:e.parseNextString(3,"FileID"),majorVersion:e.parseNextNumber(1,"MajorVersion"),revisionNumber:e.parseNextNumber(1,"RevisionNumber"),flags:e.parseNextNumber(1,"Flags"),tagSize:e.parseNextSize(4,"TagSize","the highest bit of each byte is set to zero in every byte, making a total of 28 bits")},r=o=>o&127|(o>>8&127)<<7|(o>>16&127)<<14|(o>>24&127)<<21;t.tagSize.value=r(t.tagSize.value);const s=e.createCompoundRegion("TagHeader",t),n=e.createCompoundRegion("ID3v2",[s],"","ID3v2 tag",-1,t.tagSize.value+10);return n.subRegions.push(...this.parseId3v2Frames(e.fork(-1,t.tagSize.value))),n.endPos=t.tagSize.value+10,n}parseId3v2Frames(e){const t=[];for(;!e.EOF();){const r=e.parseNextString(4,"ID"),s=e.parseNextSize(4,"Size"),n=e.parseNextNumber(2,"Flags"),o=this.parseId3v2FrameContent(e.fork(-1,s.value),r.value);if(s.value===0)break;t.push(e.createCompoundRegion(`Frame ${r.value}`,[r,s,n,...o.contents],o.interpretedValue,"ID3v2 Frame")),e.advance(s.value)}return t}parseId3v2FrameContent(e,t){const r=[];let s="";if(t.startsWith("T")){const n=e.parseNextNumber(1,"Encoding"),o=e.parseNextNullTerminatedString(-1,"Text");r.push(n,o),s=o.value}else r.push(e.parseNextData(-1,"Content"));return{contents:r,interpretedValue:s}}}const y={};function oe(){y.ico=new W,y.bmp=new V,y.h264=new Y,y.zip=new Q,y.riff=new K,y.ttf=new se,y.mp3=new ne,y.mp4=new J,y.ber=new ee,y.png=new z}function ie(){return y}function ae(c,e,t){var n;const r=((n=e.split(".").pop())==null?void 0:n.toLowerCase())||"";let s=null;if(t)s=y[t];else for(const o of Object.keys(y)){const i=y[o];let a=!1;if(typeof i.supports=="function"?a=i.supports(e,r,c):a=i.supports.indexOf(r)>=0,a){s=i,console.log("selected parser: "+o);break}}try{if(s===null)throw"couldn't find a parser";let o=new F(c);const i=s.parse(o);return Array.isArray(i)?{buffer:c,region:o.createCompoundRegion(s.description||s.constructor.name,i)}:{buffer:c,region:i}}catch(o){return console.log(o),{buffer:c,region:{ID:"General Format",type:m.GeneralData,description:"",startPos:0,endPos:c.byteLength,subRegions:[]}}}}function ce(c,e,t){c/=255,e/=255,t/=255;var r=Math.max(c,e,t),s=Math.min(c,e,t),n=0,o,i=(r+s)/2;if(r==s)n=o=0;else{var a=r-s;switch(o=i>.5?a/(2-r-s):a/(r+s),r){case c:n=(e-t)/a+(e<t?6:0);break;case e:n=(t-c)/a+2;break;case t:n=(c-e)/a+4;break}n/=6}return[n,o,i]}function k(c,e,t){var r,s,n;if(e==0)r=s=n=t;else{let a=function(l,d,u){return u<0&&(u+=1),u>1&&(u-=1),u<.16666666666666666?l+(d-l)*6*u:u<.5?d:u<.6666666666666666?l+(d-l)*(.6666666666666666-u)*6:l};var o=t<.5?t*(1+e):t+e-t*e,i=2*t-o;r=a(i,o,c+1/3),s=a(i,o,c),n=a(i,o,c-1/3)}return[r*255,s*255,n*255]}function R(c,e){const t=document.createElement(c);return t.textContent=e,t}function le(c,e){var t;(t=c.parentElement)==null||t.insertBefore(e,c.nextElementSibling)}function ue(c){let e=c.getBoundingClientRect();return{x:e.x+document.body.scrollLeft,y:e.y+document.body.scrollTop,width:e.width,height:e.height}}function de(c,e){c.style.display=c.style.display==="none"?e:"none"}class me{constructor(e,t=!1){h(this,"search");h(this,"skip");h(this,"reverseSearch");this.reverseSearch=t,[this.search,this.skip]=this.boyerMoore(e)}findIndex(e){return this.search(e)}findIndexes(e){const t=[];for(let r=this.search(e);r!==-1;r=this.search(e,r+this.skip))t.push(r);return t}asUint8Array(e){if(e instanceof Uint8Array)return e;if(typeof e=="string"){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++){const s=e.charCodeAt(r);if(s>127)throw new TypeError("Only ASCII patterns are supported");t[r]=s}return t}else return new Uint8Array(e)}boyerMoore(e){const t=this.asUint8Array(e),r=t.length;if(r===0)throw new TypeError("patternBuffer must be at least 1 byte long");const s=256,n=new Int32Array(s);for(let i=0;i<s;i++)n[i]=-1;for(let i=0;i<r;i++){const a=this.reverseSearch?t[r-1-i]:t[i];n[a]=i}return[(i,a=0,l)=>{const d=this.asUint8Array(i);l===void 0&&(l=d.length);const u=t,p=n,f=l-u.length,x=u.length-1;let N;for(let v=a;v<=f;v+=N){N=0;for(let S=x;S>=0;S--){const T=this.reverseSearch?d[l-1-v-S]:d[v+S];if((this.reverseSearch?u[u.length-1-S]:u[S])!==T){N=Math.max(1,S-p[T]);break}}if(N===0)return v}return-1},t.byteLength]}}const he="_data_view_1mqd8_15",pe="_text_1mqd8_23",fe="_offset_1mqd8_31",ge="_highlight_1mqd8_39",Ne="_tree_1mqd8_47",be="_select_1mqd8_99",xe="_cover_1mqd8_105",ve="_view_1mqd8_171",ye="_data_1mqd8_15",Se="_newGroup_1mqd8_195",Ce="_interpreted_1mqd8_205",Re="_position_1mqd8_215",De="_caret_1mqd8_237",Te="_nested_1mqd8_275",Pe="_active_1mqd8_285",we="_tooltip_1mqd8_293",Ee="_description_1mqd8_315",g={data_view:he,text:pe,offset:fe,highlight:ge,tree:Ne,select:be,cover:xe,"virtual-group":"_virtual-group_1mqd8_111",view:ve,data:ye,newGroup:Se,interpreted:Ce,position:Re,"tree-btn":"_tree-btn_1mqd8_225",caret:De,"caret-down":"_caret-down_1mqd8_265",nested:Te,active:Pe,tooltip:we,description:Ee};class _e{constructor(e,t){h(this,"container");h(this,"dom");h(this,"tdOffset");h(this,"tdData");h(this,"tdText");h(this,"positionElement");h(this,"tree");h(this,"desc");h(this,"tooltip");h(this,"columns");h(this,"rows");h(this,"offset");h(this,"highlights");h(this,"searchHighlights",[]);h(this,"selectedRow");h(this,"virtualGroupThreshold",1e3);h(this,"virtualGroupSize",100);h(this,"searchPosition",0);this.container=e,this.dom=t,this.tdOffset=[],this.tdData=[],this.tdText=[],this.columns=16,this.rows=16,this.offset=0,this.highlights=[],this.positionElement=document.createElement("span"),this.positionElement.className=g.position,this.tooltip=document.createElement("span"),this.desc=document.createElement("div"),this.tree=document.createElement("div")}visualize(){var a;this.container.innerHTML="";const e=document.createElement("table");this.container.appendChild(e);const t=document.createElement("tr");e.appendChild(t);const r=document.createElement("td");t.appendChild(r),r.classList.add(g.tree),r.style.verticalAlign="top";const s=this.tree;r.appendChild(s),s.classList.add(g.tree);const n=document.createElement("td");n.classList.add(g.view),n.style.verticalAlign="top",t.appendChild(n),this.desc.classList.add(g.description);const o=this.createSearchBar();this.createNavigateButtons(n,o),n.appendChild(o),this.createDataView(n,this.columns,this.rows),n.appendChild(this.desc),this.gotoOffset(0),s.style.height=n.offsetHeight-10+"px",this.createTree(s,this.dom.region),(a=document.querySelector("div.tooltip"))==null||a.remove();const i=document.createElement("div");i.style.position="absolute",i.classList.add(g.tooltip),document.body.appendChild(i),i.appendChild(this.tooltip),i.style.display="none"}syncTree(e){const t=U(e,this.dom.region),r=i=>[...this.tree.querySelectorAll("tr")].find(a=>a.region===i);let s=this.dom.region;for(const i of t){const a=s.subRegions[i],l=r(a);(!l||l.style.display==="none")&&r(s).btn.click(),s=a}const n=this.offset,o=r(e);o==null||o.click(),this.ensureVisible(n)}createSearchBar(){const e=document.createElement("div");e.style.display="flex",e.style.justifyContent="space-between";let t=document.createElement("div");t.style.display="inline-block",t.className="btn-group";const r=document.createElement("input");r.type="text";let s=this.createBtn("上一个文本","btn btn-outline-primary",()=>{this.search(r.value,!1,!1)});t.appendChild(s),t.appendChild(r),s=this.createBtn("下一个文本","btn btn-outline-primary",()=>{this.search(r.value,!0,!1)}),t.appendChild(s),e.appendChild(t),t=document.createElement("div"),t.style.display="inline-block",t.className="btn-group";const n=document.createElement("input");return n.type="text",s=this.createBtn("上一个值","btn btn-outline-primary",()=>{this.search(n.value,!1,!0)}),t.appendChild(s),t.appendChild(n),s=this.createBtn("下一个值","btn btn-outline-primary",()=>{this.search(n.value,!0,!0)}),t.appendChild(s),e.appendChild(t),e.style.display="none",e}clearSearch(){this.searchHighlights=[],this.searchPosition=0,this.refreshDataView()}refreshDataView(){this.gotoPage(this.getPage(this.offset))}createNavigateButtons(e,t){let r;const s=this,n=this.columns*this.rows,o=Math.ceil(this.dom.buffer.byteLength/n)-1,i=this.dom.buffer.byteLength,a=document.createElement("div");e.appendChild(a),a.style.display="flex",a.style.justifyContent="space-between";let l=document.createElement("div");l.style.display="inline-block",l.className="btn-group",r=this.createBtn("首页","btn btn-outline-primary",()=>s.gotoOffset(0)),l.appendChild(r),r=this.createBtn("上一页","btn btn-outline-primary",()=>s.gotoOffset(Math.max(s.offset-n,0))),l.appendChild(r),r=this.createBtn("下一页","btn btn-outline-primary",()=>s.gotoOffset(Math.min(s.offset+n,o*n))),l.appendChild(r),r=this.createBtn("尾页","btn btn-outline-primary",()=>s.gotoOffset(o*n)),l.appendChild(r),a.appendChild(l),a.appendChild(this.positionElement),l=document.createElement("div"),l.style.display="inline-block",l.className="btn-group",r=this.createBtn("转到页","btn btn-outline-primary",function(){let d=prompt("转到哪一页?");if(d===null)return;let u=parseInt(d);u<0&&(u=0),u>o&&(u=o),s.gotoOffset(u*n)}),l.appendChild(r),r=this.createBtn("转到位置","btn btn-outline-primary",function(){const d=prompt("输入位置, 例如: 33949, 0x1000, 50%");if(d===null)return;let u=parseInt(d);d.endsWith("%")&&(u=i*u/100);let p=Math.ceil(u/n)-1;p<0&&(p=0),p>o&&(p=o),s.gotoOffset(p*n)}),l.appendChild(r),r=this.createBtn("搜索","btn btn-outline-primary",()=>{de(t,"flex"),t.style.display==="none"&&this.clearSearch()}),l.appendChild(r),a.appendChild(l)}createTree(e,t){var a;const r=document.createElement("table");r.className=g.tree;const s=document.createElement("thead"),n=document.createElement("tr");n.append(R("th","name")),n.append(R("th","length")),n.append(R("th","value")),s.appendChild(n),r.appendChild(s);const o=document.createElement("tbody");r.append(o),e.appendChild(r);const i=this.createRegionRow(t,0);o.appendChild(i),(a=i.btn)==null||a.click()}createBtn(e,t,r){let s=document.createElement("button");return s.textContent=e,s.classList.add(...t.split(" ")),s.onclick=r,s}isNumberType(e){return e===m.UnsignedNumber||e===m.SignedNumber||e===m.Offset||e===m.Size}isStringType(e){return e===m.String||e===m.NullTerminatedString}getRegionDisplayText(e){let t="";if(this.isNumberType(e.type)){const r=e.value,s=e.interpretedValue;t=` 0x${r.toString(16)} (${s||r})`}else this.isStringType(e.type)?t=e.value+(e.interpretedValue?` (${e.interpretedValue})`:""):t=e.interpretedValue||"";return t}onRowSelect(e){this.selectedRow&&(this.selectedRow.classList.remove(g.select),this.delRegionRowStyle(this.selectedRow,g.cover)),this.selectedRow=e,this.selectedRow.classList.add(g.select),this.addRegionRowStyle(this.selectedRow,g.cover);const t=e.region;if(this.highlights=[],t.type===m.Compound)for(const r of t.subRegions)r!==void 0&&this.highlights.push({color:this.getColorForDataType(r.type),start:r.startPos,end:r.endPos,title:this.getRegionDisplayText(r)});this.highlights.push({color:this.getColorForDataType(t.type),start:t.startPos,end:t.endPos,title:this.getRegionDisplayText(t)}),this.gotoPage(this.getPage(t.startPos)),this.desc.textContent=t.description}onTreeBtnClick(e){this.toggleExpansion(e.row)}toggleExpansion(e){const t=e.region;if(e.expand)e.btn.textContent="+",e.expand=!1,this.hideRegionRowsRecursive(e);else{e.btn.textContent="-";const r=e.depth;if(e.childRows===void 0&&t.type===m.Compound){e.childRows=[];const s=t;if(s.subRegions.length<this.virtualGroupThreshold||e.startIndex!==void 0){const n=e.startIndex||0,o=e.endIndex||s.subRegions.length;for(let i=n;i<o;i++){let a=s.subRegions[i];a===void 0&&s.subRegionFetcher!==void 0&&(a=s.subRegionFetcher(i)),e.childRows.push(this.createRegionRow(a,r+1))}}else for(let n=0;n<s.subRegions.length;n+=this.virtualGroupSize){const o=this.createRegionRow(s,r+1,n,Math.min(n+this.virtualGroupSize,s.subRegions.length));e.childRows.push(o)}for(const n of e.childRows.reverse())le(e,n);this.selectedRow&&this.addRegionRowStyle(this.selectedRow,g.cover)}e.expand=!0,this.showRegionRowsRecursive(e)}}showRegionRowsRecursive(e){for(const t of e.childRows)t.style.display="",t.expand&&this.showRegionRowsRecursive(t)}hideRegionRowsRecursive(e){for(const t of e.childRows)t.style.display="none",t.expand&&this.hideRegionRowsRecursive(t)}addRegionRowStyle(e,t){if(e.childRows)for(const r of e.childRows)r.classList.add(t),this.addRegionRowStyle(r,t)}delRegionRowStyle(e,t){if(e.childRows)for(const r of e.childRows)r.classList.remove(t),this.delRegionRowStyle(r,t)}createRegionRow(e,t,r,s){const n=document.createElement("tr"),o=document.createElement("td");if(o.style.paddingLeft=`${t*20}px`,e.type===m.Compound){const i=document.createElement("span");i.textContent="+",i.classList.add(g["tree-btn"]),i.onclick=a=>{a.currentTarget&&this.onTreeBtnClick(a.currentTarget),a.stopPropagation()},o.ondblclick=a=>{(window.getSelection()===null||window.getSelection().toString()==="")&&(a.currentTarget&&this.onTreeBtnClick(i),a.stopPropagation())},i.row=n,n.btn=i,n.startIndex=r,n.endIndex=s,o.append(i),r!==void 0?(o.append(`${r}-${s-1}`),n.classList.add(g["virtual-group"])):o.append(`${e.ID}`)}else o.append(e.ID);return n.append(o),n.append(R("td",`${e.endPos-e.startPos}`)),n.append(this.createValueCell(e)),n.region=e,n.depth=t,n.expand=!1,n.onclick=i=>this.onRowSelect(i.currentTarget),n}createValueCell(e){var r;const t=R("td",this.getRegionDisplayText(e));if((r=e.interpretedValue)!=null&&r.startsWith("color:")){const s=e.interpretedValue.slice(6),n=R("span","　");n.style.backgroundColor=s,t.prepend(n)}return t}createDataView(e,t,r){const s=document.createElement("table");s.classList.add(g.data_view),e.appendChild(s);for(let n=0;n<r;n++){const o=document.createElement("tr");s.appendChild(o);const i=document.createElement("td");i.classList.add(g.offset),o.appendChild(i),this.tdOffset.push(i);const a=[];this.tdData.push(a);for(let d=0;d<t;d++){const u=document.createElement("td");d>0&&d%8===0&&u.classList.add(g.newGroup),o.appendChild(u),u.classList.add(g.data),u.row=n,u.col=d,u.offset=n*this.columns+d,a.push(u),u.onmouseover=p=>{const f=p.target,x=_(this.offset+f.offset,[this.dom.region]);this.tooltip.innerText=x?this.getRegionDesc(x):"";const N=ue(f);this.tooltip.parentElement.style.top=N.y+N.height+"px",this.tooltip.parentElement.style.left=N.x+N.width+"px",this.tooltip.parentElement.style.display="block"},u.onmouseleave=p=>{this.tooltip.parentElement.style.display="none"},u.ondblclick=p=>{const f=p.target,x=_(this.offset+f.offset,[this.dom.region]);x&&this.syncTree(x)}}const l=document.createElement("td");l.classList.add(g.text),o.appendChild(l),this.tdText.push(l)}}gotoOffset(e){this.offset=e;const t=Math.floor(e/(this.columns*this.rows)),r=Math.floor(this.dom.buffer.byteLength/(this.columns*this.rows));this.positionElement!==void 0&&(this.positionElement.innerText=`${t+1} / ${r+1}`);const s=new Uint8Array(this.dom.buffer,e);let n=!1,o=-1;const i=[...this.searchHighlights,...this.highlights];for(let a=0;a<this.rows;a++){const l=this.toHex(e+a*this.columns);this.tdOffset[a].textContent=l;let d="";for(let u=0;u<this.columns;u++){const p=a*this.columns+u,f=this.tdData[a][u];if(p<s.byteLength){const x=s[p];d+=x>32&&x<128?String.fromCharCode(x):"·",this.tdData[a][u].textContent=x.toString(16).padStart(2,"0");const N=i.findIndex(v=>e+p>=v.start&&e+p<v.end);if(N>=0){o!==-1&&o!=N&&(this.isSameColor(i[o].color,this.highlights[N].color)?n=!n:n=!1),o=N;let v=i[N].color;if(n){let[A,$,w]=ce(...v);w+=(1-w)/2,v=k(A,$,w)}const[S,T,I]=v;f.style.backgroundColor=`rgb(${S}, ${T}, ${I})`}else f.style.backgroundColor="#FFFFFF"}else d+=" ",f.textContent="",f.style.backgroundColor="#FFFFFF"}this.tdText[a].textContent=d}}gotoPage(e){this.gotoOffset(e*this.columns*this.rows)}ensureVisible(e){const t=Math.floor(e/this.columns)*this.columns;t!==this.offset&&this.gotoOffset(t)}toHex(e){return"0X"+e.toString(16).padStart(8,"0")}getPage(e){return Math.floor(e/(this.columns*this.rows))}getParentLI(e){for(;e;){if(e.tagName==="LI")return e;e=e.parentElement}return e}createElement(e,t){const r=document.createElement(e);return r.classList.add(...t),r}isSameColor(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}getColorForDataType(e){const t={[m.UnsignedNumber]:[0,1,.85],[m.SignedNumber]:[0,1,.85],[m.String]:[.3,1,.9],[m.NullTerminatedString]:[.3,1,.9],[m.Offset]:[.5,1,.9],[m.Size]:[.8333333333333334,1,.9],[m.Compound]:[0,0,.8],[m.GeneralData]:[.15,0,.9]};return k(...t[e])}getRegionTypeDesc(e){switch(e){case m.Compound:return"Compound";case m.GeneralData:return"GeneralData";case m.NullTerminatedString:return"NullTerminatedString";case m.Offset:return"Offset";case m.SignedNumber:return"SignedNumber";case m.UnsignedNumber:return"UnsignedNumber";case m.Size:return"Size";case m.String:return"String"}}getRegionDesc(e){const t=[];let r=e.parent;for(;r;){let i=1,a=0;if(r.parent)for(let l=0;l<r.parent.subRegions.length;l++)r.parent.subRegions[l].ID===r.ID&&a++,r.parent.subRegions[l]===r&&(i=a);t.push(r.ID+(a>1?`#${i}`:"")+(r.interpretedValue?` (${r.interpretedValue})`:"")),r=r.parent}const s=[...t.reverse(),e.ID].join(" / "),n=`type: ${this.getRegionTypeDesc(e.type)}`,o=[s,n];if(this.isNumberType(e.type)){const a=e.value;o.push(`value: 0x${a.toString(16)} (${a})`)}else this.isStringType(e.type)&&o.push("value: "+e.value);return o.join(`
`)}search(e,t,r){if(e==="")return;const s=r?new Uint8Array(e.split(" ").map(i=>parseInt(i,16))):e,n=new me(s,!t),o=t?n.findIndex(new Uint8Array(this.dom.buffer,this.searchPosition)):n.findIndex(new Uint8Array(this.dom.buffer,0,this.searchPosition));if(o===-1)alert("没有找到"),this.searchPosition=0,this.searchHighlights=[],this.gotoPage(this.getPage(this.offset));else{const i=t?o+this.searchPosition:this.searchPosition-o-s.length;console.log(i),this.searchHighlights=[{color:[255,255,128],start:i,end:i+s.length,title:e}],this.gotoPage(this.getPage(i)),this.searchPosition=t?i+1:i+s.length-1,console.log("new search position",this.searchPosition)}}}document.body.onload=Fe;function Fe(){oe();let c=document.createElement("div"),e=document.createElement("input");e.type="file",document.body.appendChild(e),document.body.appendChild(document.createElement("br")),document.body.appendChild(c),document.body.appendChild(Ie()),e.onchange=async function(t){if(e.files===null)return;const r=e.files[0];console.log(r);const s=await r.arrayBuffer();O(s,r.name,c)};try{fetch("/samples/x.ico").then(t=>t.arrayBuffer()).then(t=>O(t,"/samples/x.ico",c))}catch(t){console.log(t)}}function Ie(){const c=r=>r.replace(/Parser$/,""),e=ie(),t=document.createElement("div");t.textContent="Supported file formats:";for(const r of Object.keys(e)){const s=e[r],n=document.createElement("span");n.style.margin="5px",n.textContent=s.description||c(s.constructor.name),t.appendChild(n)}return t}function O(c,e,t){const r=ae(c,e);console.log(r),new _e(t,r).visualize()}
